"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3549],{3549:(V,P,o)=>{o.r(P),o.d(P,{StripeWeb:()=>z});var a=o(5861),Z=o(7423),l=o(2903),u=o(4132),m=o(741),h=o(9092);const R=(n=window)=>{if(typeof n>"u")return[];n.Ionic=n.Ionic||{};let e=n.Ionic.platforms;return null==e&&(e=n.Ionic.platforms=N(n),e.forEach(t=>n.document.documentElement.classList.add(`plt-${t}`))),e},N=n=>Object.keys(L).filter(e=>L[e](n)),f=n=>!!(p(n,/iPad/i)||p(n,/Macintosh/i)&&y(n)),v=n=>p(n,/android|sink/i),y=n=>H(n,"(any-pointer:coarse)"),A=n=>C(n)||g(n),C=n=>!!(n.cordova||n.phonegap||n.PhoneGap),g=n=>{const e=n.Capacitor;return!(null==e||!e.isNative)},p=(n,e)=>e.test(n.navigator.userAgent),H=(n,e)=>n.matchMedia(e).matches,L={ipad:f,iphone:n=>p(n,/iPhone/i),ios:n=>p(n,/iPhone|iPod/i)||f(n),android:v,phablet:n=>{const e=n.innerWidth,t=n.innerHeight,i=Math.min(e,t),r=Math.max(e,t);return i>390&&i<520&&r>620&&r<800},tablet:n=>{const e=n.innerWidth,t=n.innerHeight,i=Math.min(e,t),r=Math.max(e,t);return f(n)||(n=>v(n)&&!p(n,/mobile/i))(n)||i>460&&i<820&&r>780&&r<1400},cordova:C,capacitor:g,electron:n=>p(n,/electron/i),pwa:n=>!(!n.matchMedia("(display-mode: standalone)").matches&&!n.navigator.standalone),mobile:y,mobileweb:n=>y(n)&&!A(n),desktop:n=>!y(n),hybrid:A};class z extends Z.Uw{constructor(){super({name:"Stripe",platforms:["web"]})}initialize(e){var t=this;return(0,a.Z)(function*(){if("string"!=typeof e.publishableKey||0===e.publishableKey.trim().length)throw new Error("you must provide a valid key");t.publishableKey=e.publishableKey,e.stripeAccount&&(t.stripeAccount=e.stripeAccount)})()}createIdentityVerificationSheet(e){return(0,a.Z)(function*(){})()}presentIdentityVerificationSheet(){throw new Error("Method not implemented.")}createPaymentSheet(e){var t=this;return(0,a.Z)(function*(){var i;t.publishableKey?(t.paymentSheet=document.createElement("stripe-payment-sheet"),null===(i=document.querySelector("body"))||void 0===i||i.appendChild(t.paymentSheet),yield customElements.whenDefined("stripe-payment-sheet"),t.paymentSheet.publishableKey=t.publishableKey,t.stripeAccount&&(t.paymentSheet.stripeAccount=t.stripeAccount),t.paymentSheet.applicationName="@capacitor-community/stripe",t.paymentSheet.intentClientSecret=e.paymentIntentClientSecret,t.paymentSheet.intentType="payment",void 0!==e.withZipCode&&(t.paymentSheet.zip=e.withZipCode),t.notifyListeners(l.Y.Loaded,null)):t.notifyListeners(l.Y.FailedToLoad,null)})()}presentPaymentSheet(){var e=this;return(0,a.Z)(function*(){if(!e.paymentSheet)throw new Error;const t=yield e.paymentSheet.present();if(void 0===t)return e.notifyListeners(l.Y.Canceled,null),{paymentResult:l.Y.Canceled};const{detail:{stripe:i,cardNumberElement:r}}=t,s=yield i.createPaymentMethod({type:"card",card:r});return e.paymentSheet.updateProgress("success"),e.paymentSheet.remove(),void 0!==s.error?(e.notifyListeners(l.Y.Failed,null),{paymentResult:l.Y.Failed}):(e.notifyListeners(l.Y.Completed,null),{paymentResult:l.Y.Completed})})()}createPaymentFlow(e){var t=this;return(0,a.Z)(function*(){var i;t.publishableKey?(t.paymentSheet=document.createElement("stripe-payment-sheet"),null===(i=document.querySelector("body"))||void 0===i||i.appendChild(t.paymentSheet),yield customElements.whenDefined("stripe-payment-sheet"),t.paymentSheet.publishableKey=t.publishableKey,t.stripeAccount&&(t.paymentSheet.stripeAccount=t.stripeAccount),t.paymentSheet.applicationName="@capacitor-community/stripe",e.hasOwnProperty("paymentIntentClientSecret")?(t.paymentSheet.intentType="payment",t.paymentSheet.intentClientSecret=e.paymentIntentClientSecret):(t.paymentSheet.intentType="setup",t.paymentSheet.intentClientSecret=e.setupIntentClientSecret),void 0!==e.withZipCode&&(t.paymentSheet.zip=e.withZipCode),((n,e)=>("string"==typeof n&&(e=n,n=void 0),(n=>R(n))(n).includes(e)))(window,"ios")?(t.paymentSheet.buttonLabel="Add card",t.paymentSheet.sheetTitle="Add a card"):t.paymentSheet.buttonLabel="Add",t.notifyListeners(u.I.Loaded,null)):t.notifyListeners(u.I.FailedToLoad,null)})()}presentPaymentFlow(){var e=this;return(0,a.Z)(function*(){if(!e.paymentSheet)throw new Error;e.notifyListeners(u.I.Opened,null);const t=yield e.paymentSheet.present().catch(()=>{});if(void 0===t)throw e.notifyListeners(u.I.Canceled,null),new Error;const{detail:{stripe:i,cardNumberElement:r}}=t,{token:s}=yield i.createToken(r);if(void 0===s||void 0===s.card)throw new Error;return e.flowStripe=i,e.flowCardNumberElement=r,e.notifyListeners(u.I.Created,{cardNumber:s.card.last4}),{cardNumber:s.card.last4}})()}confirmPaymentFlow(){var e=this;return(0,a.Z)(function*(){if(!e.paymentSheet||!e.flowStripe||!e.flowCardNumberElement)throw new Error;return void 0!==(yield e.flowStripe.createPaymentMethod({type:"card",card:e.flowCardNumberElement})).error&&e.notifyListeners(u.I.Failed,null),e.paymentSheet.updateProgress("success"),e.paymentSheet.remove(),e.notifyListeners(u.I.Completed,null),{paymentResult:u.I.Completed}})()}isApplePayAvailable(){return this.isAvailable("applePay")}createApplePay(e){var t=this;return(0,a.Z)(function*(){t.publishableKey?(t.requestApplePay=yield t.createPaymentRequestButton(),t.requestApplePayOptions=e,t.notifyListeners(m.Y.Loaded,null)):t.notifyListeners(m.Y.FailedToLoad,null)})()}presentApplePay(){return this.presentPaymentRequestButton("applePay",this.requestApplePay,this.requestApplePayOptions,m.Y)}isGooglePayAvailable(){return this.isAvailable("googlePay")}createGooglePay(e){var t=this;return(0,a.Z)(function*(){t.publishableKey?(t.requestGooglePay=yield t.createPaymentRequestButton(),t.requestGooglePayOptions=e,t.notifyListeners(h.u.Loaded,null)):t.notifyListeners(h.u.FailedToLoad,null)})()}presentGooglePay(){return this.presentPaymentRequestButton("googlePay",this.requestGooglePay,this.requestGooglePayOptions,h.u)}isAvailable(e){var t=this;return(0,a.Z)(function*(){var i;const r=document.createElement("stripe-payment-request-button");return r.id=`isAvailable-${e}`,null===(i=document.querySelector("body"))||void 0===i||i.appendChild(r),yield customElements.whenDefined("stripe-payment-request-button"),t.publishableKey&&(r.publishableKey=t.publishableKey),t.stripeAccount&&(r.stripeAccount=t.stripeAccount),r.applicationName="@capacitor-community/stripe",yield r.isAvailable(e).finally(()=>r.remove())})()}createPaymentRequestButton(){var e=this;return(0,a.Z)(function*(){var t;const i=document.createElement("stripe-payment-request-button");return null===(t=document.querySelector("body"))||void 0===t||t.appendChild(i),yield customElements.whenDefined("stripe-payment-request-button"),e.publishableKey&&(i.publishableKey=e.publishableKey),e.stripeAccount&&(i.stripeAccount=e.stripeAccount),i.applicationName="@capacitor-community/stripe",i})()}presentPaymentRequestButton(e,t,i,r){var s=this;return(0,a.Z)(function*(){return new Promise(function(){var U=(0,a.Z)(function*(c){if(void 0===t||void 0===i||void 0===s.publishableKey)return s.notifyListeners(r.Failed,null),c({paymentResult:r.Failed});yield t.setPaymentRequestOption({country:i.countryCode.toUpperCase(),currency:i.currency.toLowerCase(),total:i.paymentSummaryItems[i.paymentSummaryItems.length-1],disableWallets:"applePay"===e?["googlePay","browserCard"]:["applePay","browserCard"],requestPayerName:!0,requestPayerEmail:!0});const I=i.paymentIntentClientSecret;yield t.setPaymentMethodEventHandler(function(){var O=(0,a.Z)(function*(d,b){const{paymentIntent:S,error:w}=yield b.confirmCardPayment(I,{payment_method:d.paymentMethod.id},{handleActions:!1});if(w)return d.complete("fail"),s.notifyListeners(r.Failed,w),c({paymentResult:r.Failed});if("requires_action"===(null==S?void 0:S.status)){const{error:K}=yield b.confirmCardPayment(I);if(K)return d.complete("fail"),s.notifyListeners(r.Failed,K),c({paymentResult:r.Failed})}return d.complete("success"),s.notifyListeners(r.Completed,null),c({paymentResult:r.Completed})});return function(d,b){return O.apply(this,arguments)}}()),yield t.initStripe(s.publishableKey,{stripeAccount:s.stripeAccount,showButton:!1})});return function(c){return U.apply(this,arguments)}}())})()}}}}]);